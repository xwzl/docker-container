input {
  tcp {
    mode => "server"
    host => "0.0.0.0"
    port => 5044
    codec => json_lines
 }
   # 来源beats
  beats {
      # 端口
      port => "5045"
  }
}

filter {
        # grok
        # 匹配日志格式
        grok {
                match => { "message" => "\| %{IPV4:clientIp} %{IPV4:host} %{TIMESTAMP_ISO8601:timeStamp}\s{0,10}%{LOGLEVEL:level}\s{0,10}%{NUMBER:pid}\s{0,10}\---\s{0,10}\[%{USER:appName}\]\s{0,10}\[\s{0,15}%{USER:threadName}\]\s{0,10}\[TID:%{USERNAME:tid}\] \.{0,1}%{JAVACLASS:class}\s{0,40}:%{JAVALOGMESSAGE:msg}" }	#在这里引用
        }
        # 删除无用字段
        mutate {
            enable_metric => "false"
            remove_field => ["file","agent","containerized","host","@version","event"]
        }
        # 过滤掉无用数据
        if [appName] == '' {
            drop{}
        }
}


output {
  elasticsearch {
    hosts => "1.15.19.68:9200"
    user => "elastic"
    password => "elastic"
    index => "logstash-%{+YYYY.MM.dd}"
  }
 # 控制台打印
  stdout {codec => rubydebug}
}
